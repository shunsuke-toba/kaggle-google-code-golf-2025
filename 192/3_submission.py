p=lambda g:(t:=[x for x in sum(g,[])if x],c:=max(t,key=t.count),s:=min(t,key=t.count),[[v*(v!=s)+c*(v==s and((i and g[i-1][j]==c or i+1<len(g)and g[i+1][j]==c)and(j and r[j-1]==c or j+1<len(r)and r[j+1]==c)))for j,v in enumerate(r)]for i,r in enumerate(g)])[3]
