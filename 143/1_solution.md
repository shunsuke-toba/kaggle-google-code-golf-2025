# 問題の考察ポイントと解き方

## 考察ポイント

1. **グレー領域内のパターン認識**

   - 左上の 4x4 領域（0,0）〜（3,3）がテンプレート領域
   - グレー(5)以外の非黒セルが形成するパターンを記憶

2. **連結成分による形状マッチング**

   - パターンは連結成分として認識（4 連結）
   - 複数の連結成分がある場合は、それぞれを独立に扱う
   - 色は異なっても形状が同じならマッチと判定

3. **探索範囲**
   - グレー領域外（y>3 または x>3）の全ての連結成分を探索
   - 各色ごとに連結成分を抽出して形状比較

## 解くための手続き

1. **テンプレートパターンの抽出**

   - 4x4 のグレー領域内で、非グレー(5)かつ非黒(0)のセルを収集
   - これらのセルから連結成分を検出（4 連結の BFS/DFS）

2. **パターンの正規化**

   - 各連結成分を相対座標に変換（最小座標を(0,0)に）
   - ソートして形状のシグネチャを作成

3. **グリッド全体の探索**

   - 各色（1〜9、5 を除く）について、グレー領域外のセルを収集
   - 色ごとに連結成分を検出

4. **形状マッチングと変換**

   - 各連結成分を正規化して、テンプレートパターンと比較
   - 形状が一致した連結成分の全セルをグレー(5)に変換

5. **結果の返却**
   - 変換後のグリッドを返す
