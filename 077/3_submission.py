p=lambda g,n=24:n and p([*zip(*[[(c,4)[c-2and 20>>l&(20>>n|20>>u)&1]for c,l,n,u in zip(r,[0,*r],[*r[1:],0],a)]for a,r in zip(g[:1]+g,g)][::-1])],n-1)or g