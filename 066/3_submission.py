def p(g):n=len(g);(a,b),(c,d)=[divmod(i,n)for i in range(n*n)if g[i//n][i%n]==3];f=lambda y,x,a,b,t=2:0<=(y:=y+a)<n>(x:=x+b)>=0 and((v:=g[y][x])==2 or 7<v>t>0 and(f(y-a,x-b,b,-a,t-1)or f(y-a,x-b,-b,a,t-1)) or 8>v and f(y,x,a,b,t)and(g[y].__setitem__(x,3)or 1));g[2*a-c][2*b-d]^8and f(a,b,a-c,b-d)or f(c,d,c-a,d-b);return g