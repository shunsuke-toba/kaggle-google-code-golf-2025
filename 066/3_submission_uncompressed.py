def p(g):n=len(g);(a,b),(c,d)=[(y,x)for y in range(n)for x in range(n)if g[y][x]&1];f=lambda y,x,a,b,t=2:n>(Y:=y+a)>-1<(X:=x+b)<n and(2==(v:=g[Y][X])or t*v>7and(f(y,x,b,-a,t-1)or f(y,x,-b,a,t-1))or v-8and f(Y,X,a,b,t)and[g[Y].__setitem__(X,3)]);g[2*a-c][2*b-d]-8and f(a,b,a-c,b-d)or f(c,d,c-a,d-b);return g