# Task 089: パターンの複製と反転

## 問題の考察ポイントと解き方

### 考察ポイント

1. **連結成分の探索**

   - 8 方向（上下左右＋斜め 4 方向）で隣接するブロックを同一の連結成分として扱う
   - 背景色(0)は連結判定から除外
   - サイズ 1 の連結成分と、サイズ 2 以上の連結成分を区別する必要がある

2. **パターンの特性判定**

   - 各連結成分が赤(2)または緑(3)を含むかを記録
   - パターン内での赤・緑の相対位置を記録（複製時の位置合わせに使用）

3. **単独マーカーの識別**

   - サイズ 1 の連結成分のうち、赤(2)または緑(3)であるものを単独マーカーとして扱う

4. **パターンの変換と配置**
   - 赤を含むパターン：左右反転（Y 軸反転）が必要
   - 緑を含むパターン：そのまま使用
   - マーカーの色とパターン内の同色の位置を基準点として、適切な位置に複製

### 解くための手続き

1. **連結成分の抽出**

   - DFS または BFS で 8 方向の連結成分を全て探索
   - 各連結成分について、セルの座標リストを保持

2. **連結成分の分類**

   - サイズ 1 の連結成分：赤(2)または緑(3)なら単独マーカーリストに追加
   - サイズ 2 以上の連結成分：パターンとして以下を記録
     - バウンディングボックス内のパターン配列
     - 赤(2)の有無と相対位置
     - 緑(3)の有無と相対位置

3. **パターンの複製処理**

   - 各単独マーカーに対して：
     - マーカーが赤(2)の場合：赤を含むパターンを探し、左右反転して配置
     - マーカーが緑(3)の場合：緑を含むパターンを探し、そのまま配置
   - 配置位置の計算：
     - パターン内の対応色の相対位置を基準に、マーカー位置へのオフセットを計算
     - 反転の場合は、Y 座標を`width-1-y`で変換

4. **結果の出力**
   - 元のグリッドをベースに、複製したパターンを上書き
   - 境界チェックを行い、グリッド外への書き込みを防ぐ
